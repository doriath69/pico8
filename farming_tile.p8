pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--farming game


-->8
--init

function _init()

--init player

	players = {}
	
	init_player()

 

end
-->8
--update

function _update()

	for player in all(players) do
		
		print("name: " .. player.name)
		player:update()
	
	end --end player loop
	
end

-->8
--draw

function _draw()
	cls(4)
	map()
	
	for player in all(players) do
	
		player:draw()
	
	end --end for player loop
	
end --end _draw function


-->8
--oop

-- oop - metatable

class=setmetatable({
	new=function(self,tbl)
		tbl=tbl or {}
		setmetatable(tbl,{
		 	__index=self
		 })
		return tbl
	end, --new(
},{__index=_ENV})

entity=class:new({
	x=0,
	y=0,
	h=8,
	w=8,
})


-->8
--player

--define player class object

player=entity:new({
	pos="p1",
	name="farmer",
	sprite=16,
	health=5,
	velx=0,
	vely=0,
	ptx=0,
	pty=0,
	
	update=function(_ENV)
		
			--poll controllers
			if btn(0) then
				if fget(mget(ptx-1,pty),0) then
					x+=-1
					sfx(0)
				else sfx(2)
				end
				--sprite=1
			end
			
			if btn(1) then
				if fget(mget(ptx+1,pty),0) then
					x+=1
					sfx(0)
				else sfx(2)
				end
				--sprite=3
			end
				
			if btn(2) then
				if fget(mget(ptx,pty-1),0) then
					y+=-1
					sfx(0)
				else sfx(2)
				end
				--sprite=2
			end
			
			if btn(3) then 
				if fget(mget(ptx,pty+1),0) then
					y+=1
					sfx(0)
				else sfx(2)
				end
			end
			--end controller update
			
			if btnp(5) then
				till(ptx,pty)
			end
			
			if btnp(4) then
				plant(ptx,pty)
			end
				
	
	 --update position and
	 --mantain map boundaries
	
		x = x+velx
		if x>120 then
			x = 120
			velx = 0
		elseif x < 0 then
			x=0
			velx = 0
		end
		
		
		y = y+vely
		if y>120 then
			y = 120
			vely = 0
		elseif y<=0 then
			y=0
			vely=0	
		end
		
		--get player tile location
		ptx=x/8
		pty=y/8
		
	
		
	end, --end update player function


 
	--draw player function
	
	draw = function(_ENV)
		spr(sprite,x,y)
	
	end, -- end draw player function
	
	}) --end player object definition


--start init player function

function init_player()

	p1 = player:new({
	name="player 1",
	x=40,
	y=40,
	})
	
	add(players,p1)
	
end  --end init player function


-->8
--map interaction

--tilling

--start till function
 function till(ptx,pty)
 	if fget(mget(ptx,pty),1) then
	 	sfx(1)
	 	mset(ptx,pty,32)
		end
	end --end till function


--plant seeds
	function plant(ptx,pty)
		if fget(mget(ptx,pty),2) then
	 	sfx(3)
	 	mset(ptx,pty,33)
		end
	end	
__gfx__
0000000044444444444444444ccccccc44444444ccccccc4cccccccc4444444444444444ccccccc44ccccccccccccccc444444443b3333335555555555555555
0000000044444644446444444ccccccccc4c44ccccccccc4cccccccc4ccc44cccc4c44c4ccccccc44ccccccccccccccc44d4d4d43b33b33b5555555555555555
00700700444544444454446444cccccccccccccccccccc44cccccccc44ccccccccccccc4cccccc4444cccccccccccccc4d4d4d44333333335555555555555555
00077000444444444444444444ccccccccccccccccccccc4cccccccc44ccccccccccccc4ccccccc444cccccccccccccc4444444433333b335555555555777755
0007700044444444444444444ccccccccccccccccccccc44cccccccc4ccccccccccccc44cccccc444ccccccccccccccc444444443b3333b35555555555777755
00700700464444444444444444cccccccccccccccccccc44cccccccc44cccccccccccc44cccccc444ccccccccccccccc44d4d4d43bb333335555555555555555
0000000044444454454445444cccccccccccccccccccccc4cc44c4cc4cccccccccccccc4cc44ccc44c44c4cccccccccc4d4d4d4433b33b335555555555555555
0000000044444444444444444cccccccccccccccccccccc4444444444cccccccccccccc44444444444444444cccccccc444444443333b3335555555555555555
00aaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c9c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11161110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d0d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444b4444b444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444a4d4d444b4dbd4443434d4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444444444d4d4a444d4d4b444d434d44000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44545454444444444444444444499444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
45454544444444444b444b4444599544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444d4a4d444b4b4d4444554d4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444444444a4d4d444b4d4d444d4d4d44000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b00000066666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03b000000d7777600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003390000d7377600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003990000d3997600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009999000d7997600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000d99900d7799600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000d9990d7777600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000d990dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0003030000000000000000000303010100000000000000000000000000000000070303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020101010101020202020202010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010201010102020102010704040800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010101010101010201010102030b0b0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010102020102070b0b0b0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010102020201010202030b0b0b0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010202010201020201030b0b0b0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010201010102020101020a0606060900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020102020101020202020201020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020202020202020202020101020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020202010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020101010101010101010101010200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000305000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00010000103500e05012050190501e050220500205000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000004550085500c55011550185501f550255502e5501d5500955007550065500455004550045500455000000000000000000000000000000000000000000000000000000000000000000000000000000000
00020000083501235019350273503d350353502a3501f350163501136009350053500034000350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
